{% extends "../base_form.html" %}
{% load i18n thumbnail %}

{# Blocks de base.html #}
{% block page_title %}{% translate "Profile details" %}{% endblock %}
{% block bodyclasses %}{% endblock %}
{% block mainclasses %} profile {% endblock %}
{% block extra_js %}{% endblock %}

{# Blocks de base_form.html #}
{% block enctype %}{% endblock %}
{% block submit_text %}{% endblock %}

{% block before_form_content %}
<nav class="flex mb-4" aria-label="Breadcrumb">
  <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
    <li class="inline-flex items-center">
      <a href="{% url 'home' %}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-primary-600 dark:text-gray-400 dark:hover:text-white">
        <svg class="w-3 h-3 me-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewbox="0 0 20 20">
          <path d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"/>
        </svg>
        {% translate 'Home' %}
      </a>
    </li>
  </ol>
</nav>

<!-- Modal no-entity -->
{% if not request.user.entity %}
<div id="no-entity-banner" tabindex="-1"
  aria-hidden="true"
  class="overflow-y-auto overflow-x-hidden fixed top-14 right-0 left-0 z-50
    justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full
    md:top-12"
>
  <div class="relative p-4 w-full max-w-2xl max-h-full mx-auto
    bg-white border border-gray-100 rounded-lg shadow-xs
    lg:mr-0"
  >
    <div class="flex items-start gap-4 mb-3 me-4 md:items-center md:flex-row md:mb-0">
      <svg class="w-8 h-8 text-red-700" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_1838_193283)">
          <path d="M10 0C8.02219 0 6.08879 0.58649 4.4443 1.6853C2.79981 2.78412 1.51809 4.3459 0.761209 6.17316C0.00433284 8.00042 -0.1937 10.0111 0.192152 11.9509C0.578004 13.8907 1.53041 15.6725 2.92894 17.0711C4.32746 18.4696 6.10929 19.422 8.0491 19.8078C9.98891 20.1937 11.9996 19.9957 13.8268 19.2388C15.6541 18.4819 17.2159 17.2002 18.3147 15.5557C19.4135 13.9112 20 11.9778 20 10C19.9971 7.34873 18.9426 4.80688 17.0679 2.93215C15.1931 1.05741 12.6513 0.0029116 10 0ZM10 15C9.80222 15 9.60888 14.9413 9.44443 14.8315C9.27998 14.7216 9.15181 14.5654 9.07612 14.3827C9.00044 14.2 8.98063 13.9989 9.01922 13.8049C9.0578 13.6109 9.15304 13.4327 9.2929 13.2929C9.43275 13.153 9.61093 13.0578 9.80491 13.0192C9.99889 12.9806 10.2 13.0004 10.3827 13.0761C10.5654 13.1518 10.7216 13.28 10.8315 13.4444C10.9414 13.6089 11 13.8022 11 14C11 14.2652 10.8946 14.5196 10.7071 14.7071C10.5196 14.8946 10.2652 15 10 15ZM11 11C11 11.2652 10.8946 11.5196 10.7071 11.7071C10.5196 11.8946 10.2652 12 10 12C9.73479 12 9.48043 11.8946 9.2929 11.7071C9.10536 11.5196 9 11.2652 9 11V6C9 5.73478 9.10536 5.48043 9.2929 5.29289C9.48043 5.10536 9.73479 5 10 5C10.2652 5 10.5196 5.10536 10.7071 5.29289C10.8946 5.48043 11 5.73478 11 6V11Z" />
        </g>
        <defs>
          <clipPath id="clip0_1838_193283">
            <rect width="20" height="20" fill="white"/>
          </clipPath>
        </defs>
      </svg>
      <p class="flex items-center text-md font-semibold text-gray-900 dark:text-gray-400">
        {% translate "This user has no entity." %}
      </p>
      <button data-dismiss-target="#no-entity-banner" type="button"
        class="inline-flex shrink-0 justify-center items-center w-7 h-7
          p-1.5 ml-auto text-gray-400 rounded-lg text-sm
          hover:bg-gray-100">
        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
        </svg>
        <span class="sr-only">Close banner</span>
      </button>
    </div>
    <div class="flex items-center shrink-0 pl-12">
      <p class="text-sm font-normal text-gray-500 dark:text-gray-400">
        {% translate "You can't access the rest of the site until you have an entity assigned. Please contact the administration." %}
      </p>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}

{% block form_intro %}
  <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white">
    {% translate "Your profile" %}
  </h1>
  <p>{% translate "Here you can see and edit your data." %}</p>
  {% if user.is_janitor %}
    <p class="inline-block text-sm font-medium text-gray-900 dark:text-gray-300">
      {% translate "You are a janitor at Bloc4BCN" %}
    </p>
    <button
      type="button"
      data-tooltip-target="is_janitor_helptext"
      data-tooltip-style="dark"
      class="ml-1 -mt-4">
      <svg aria-hidden="true"
        class="w-4 h-4 text-gray-400 hover:text-gray-900 dark:text-gray-500 dark:hover:text-white"
        fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd"
        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"
        clip-rule="evenodd"></path>
      </svg>
      <span class="sr-only">{% translate 'Show information' %}</span>
    </button>
    <div role="tooltip" id="is_janitor_helptext"
      class="inline-block absolute invisible z-10 py-2 px-3 max-w-sm text-xs font-normal text-white bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
      {% translate "You can't edit this information, if you want to change it, contact the administration." %}
      <div class="tooltip-arrow" data-popper-arrow></div>
    </div>
  {% endif %}
{% endblock %}

{% block form_fields %}
  {{ form }}

  {% if not user.email_verified %}
  <div class="flex items-center p-4 mb-4 bg-red-50 rounded-lg text-sm text-red-700 dark:text-red-500"
      role="alert">
    <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
      <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
    </svg>
    <span class="sr-only">Alert</span>
    <div>
      <span class="font-bold uppercase">{% translate "Warning!" %}</span>
      {% translate "Your email is not verified. Before anything else, you must verify it." %}
      <a class="font-bold hover:underline" href="{% url 'registration:send_verification_code' %}" id="id_verify_email">
        {% translate "Verify email here." %}
      </a>
    </div>
  </div>
  {% endif %}

{% endblock %}

{% block submit_whole %}
  <input type="submit"
  class="w-full px-5 py-2.5 rounded-lg bg-primary-600 text-white font-bold text-sm text-center cursor-pointer
    hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300
    dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800
    disabled:opacity-50  disabled:bg-gray-400 disabled:hover:bg-gray-400 disabled:cursor-not-allowed"
    value="{% translate 'Save' %}"
  >
{% endblock %}

{% block after_form_content %}
  <section class="bg-gray-50 dark:bg-gray-900">
    <div class="flex flex-col items-center justify-center px-6 pb-8 mx-auto
    lg:pb-16 lg:-mt-9">
      <div class="w-full bg-white rounded-lg shadow
            dark:border dark:bg-gray-800 dark:border-gray-700
            sm:max-w-lg
            md:mt-0
            xl:p-0">
        <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
          <h2 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white">
            {% translate "Password change" %}
          </h2>
          <p>{% translate "Here you can change your password." %}</p>
          <a href="{% url 'registration:password_change' %}">
            <button
              class="w-full mt-8 px-5 py-2.5 rounded-lg bg-primary-600 text-white font-bold text-sm text-center cursor-pointer
              hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300
              dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800
                disabled:opacity-50 disabled:bg-gray-400" id="id_password_change">
              {% translate 'Change password' %}
            </button>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- BACK VALUES -->
  {% if request.user.entity %}
  <section class="bg-gray-50 dark:bg-gray-900">
    <div class="flex flex-col items-center justify-center px-6 pb-8 mx-auto
    lg:pb-16 lg:-mt-9">
      <div class="relative w-full bg-white rounded-lg shadow
            dark:border dark:bg-gray-800 dark:border-gray-700
            sm:max-w-lg
            md:mt-0
            xl:p-0">
        <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
          <h2 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white">
            {% translate "Your entity" %}
          </h2>
          {% if request.user.entity.logo %}
            {% thumbnail request.user.entity.logo "300" as im %}
              <img class="absolute top-0 right-6 w-14 h-14 rounded-full" src="{{ im.url }}" alt="Rounded avatar">
            {% endthumbnail %}
          {% endif %}
          <p>{% translate "Here you can view your entity's data." %}</p>
          <div class="relative overflow-x-auto shadow-sm rounded-lg">
            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
              <tbody>
                <tr class="">
                  <th scope="row" class="px-2 py-2 border-t border-primary-50 font-medium text-gray-900 bg-primary-50 dark:text-white dark:bg-gray-800">
                    {% translate "Email" %}
                  </th>
                  <td class="px-2 py-2 border-b border-t border-gray-200 dark:border-gray-700">
                    {{ request.user.entity.entity_email }}
                  </td>
                </tr>
                <tr class="">
                  <th scope="row" class="px-2 py-2 font-medium text-gray-900 bg-primary-50 dark:text-white dark:bg-gray-800">
                    {% translate "Fiscal name" %}
                  </th>
                  <td class="px-2 py-2 border-b border-gray-200 dark:border-gray-700">
                    {{ request.user.entity.fiscal_name }}
                  </td>
                </tr>
                <tr class="">
                  <th scope="row" class="px-2 py-2 font-medium text-gray-900 bg-primary-50 dark:text-white dark:bg-gray-800">
                    {% translate "VAT number" %}
                  </th>
                  <td class="px-2 py-2 border-b border-gray-200 dark:border-gray-700">
                    {{ request.user.entity.nif }}
                  </td>
                </tr>
                <tr class="">
                  <th scope="row" class="px-2 py-2 font-medium text-gray-900 bg-primary-50 dark:text-white dark:bg-gray-800">
                    {% translate "Town" %}
                  </th>
                  <td class="px-2 py-2 border-b border-gray-200 dark:border-gray-700">
                    {{ request.user.entity.town }}
                  </td>
                </tr>
                <tr class="">
                  <th scope="row" class="px-2 py-2 font-medium text-gray-900 bg-primary-50 dark:text-white dark:bg-gray-800">
                    {% translate "Postal code" %}
                  </th>
                  <td class="px-2 py-2 border-b border-gray-200 dark:border-gray-700">
                    {{ request.user.entity.postal_code }}
                  </td>
                </tr>
                <tr class="">
                  <th scope="row" class="px-2 py-2 font-medium text-gray-900 bg-primary-50 dark:text-white dark:bg-gray-800">
                    {% translate "Address" %}
                  </th>
                  <td class="px-2 py-2 border-b border-gray-200 dark:border-gray-700">
                    {{ request.user.entity.address }}
                  </td>
                </tr>
                <tr class="">
                  <th scope="row" class="px-2 py-2 font-medium text-gray-900 bg-primary-50 dark:text-white dark:bg-gray-800">
                    {% translate "Country" %}
                  </th>
                  <td class="px-2 py-2 border-b border-gray-200 dark:border-gray-700">
                    {{ request.user.entity.country }}
                  </td>
                </tr>
                <tr class="">
                  <th scope="row" class="px-2 py-2 font-medium text-gray-900 bg-primary-50 dark:text-white dark:bg-gray-800">
                    {% translate "Responsible person" %}
                  </th>
                  <td class="px-2 py-2 border-b border-gray-200 dark:border-gray-700">
                    {% if request.user.entity.person_responsible %}
                      {{ request.user.entity.person_responsible }}
                    {% else %}
                      {% translate "None assigned" %}
                    {% endif %}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>
  {% endif %}
{% endblock %}
